## 消息队列的选择 RabbitMQ VS Kafka

### 使用场景 100路25帧的视频流

- 1、消息量估算
消息体大小：图像地址url 1kb以内
100路视频流：
每秒消息量：100 * 25 = 2,500 条/秒。
1000路视频流：(设计的视频流处理分布式集群最大视频路数)
每秒消息量：1000 * 25 = 25,000 条/秒。
- 2、消息处理能力评估(集群模式) 运维给的数据。看磁盘的读写性能
20路视频流单机测试消息在微秒级。
Kafka的高吞吐量优势会更加突出。数十万-百万条/秒
RabbitMQ的吞吐量通常在每秒几万-20万条消息左右/秒
- 3、消息处理的实时性
RabbitMQ的轻量级设计和较低的消息传递延迟可能更适合实时性要求较高的场景。实际生产过程测试生产和消费都是0点几ms级别。(所以存图不能和生产消息做异步处理)
Kafka虽然吞吐量高，但在消息传递的实时性上可能不如RabbitMQ。Kafka的延迟通常在几十毫秒到几百毫秒之间，尤其是在高吞吐量场景下。
- 4、消息的持久化
RabbitMQ的ACK机制和持久化能力可以确保消息不丢失。 
Kafka把所有消息都持久化到硬盘中 但是在某些情况下仍然可能丢失消息：
 - 生产者未收到ACK：如果生产者在发送消息后未收到Kafka的ACK，消息可能会丢失。
 - 消费者未提交偏移量：如果消费者在处理消息后未及时提交偏移量，且消费者崩溃，消息可能会被重复消费或丢失。
 - 配置不当：如果Kafka的副本配置不当（如副本数不足），在Broker宕机时可能会导致消息丢失。
RabbitMQ的消息可靠性机制更直观且易于管理，适合对消息丢失零容忍的场景。
- 5、消息的顺序性
使用 RabbitMQ，并通过单队列、单消费者模式来确保顺序性。需要设定一些机制
使用 Kafka，并通过消息键（Key）将需要保序的消息发送到同一个分区。
两者机制是一样的。
- 6、硬盘的iops占用
RabbitMQ在资源消耗上对硬盘读写性能的影响较小，尤其是生产过程中在关闭持久化的情况下。

